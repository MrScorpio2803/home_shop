{% extends "base.html" %}
{% load static %}

{% block title %}Мои отзывы и обращения{% endblock %}

{% block body %}
<div class="container my-5">
    <h2 class="mb-4">Мои отзывы и обращения</h2>

    <!-- Вкладки -->
    <ul class="nav nav-tabs" id="profileTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fw-semibold bg-light border rounded-top"
                    id="product-reviews-tab" data-bs-toggle="tab" data-bs-target="#product-reviews" type="button" role="tab">
                Отзывы о товарах ({% if product_reviews %} {{ product_count }} {% else %} 0 {% endif %})
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-semibold bg-light border rounded-top"
                    id="order-reviews-tab" data-bs-toggle="tab" data-bs-target="#order-reviews" type="button" role="tab">
                Отзывы о заказах ({% if order_reviews %} {{ order_count }} {% else %} 0 {% endif %})
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-semibold bg-light border rounded-top"
                    id="contacts-tab" data-bs-toggle="tab" data-bs-target="#contacts" type="button" role="tab">
                Обращения ({% if contacts %} {{ contacts_count }} {% else %} 0 {% endif %})
            </button>
        </li>
    </ul>

    <!-- Контент вкладок -->
    <div class="tab-content border-0 pt-4" id="profileTabsContent">

        <!-- Отзывы о товарах -->
        <div class="tab-pane fade show active" id="product-reviews" role="tabpanel">
            {% if product_reviews %}
                <div class="row g-3">
                    {% for review in product_reviews %}
                        <div class="col-md-8 col-lg-6">
                            <div class="card review-card rounded-3">
                                <div class="card-body">
                                    <a href="{% url 'catalog:product' review.product.slug %}" style="text-decoration: None; cursor: pointer"><h6 class="card-title mb-2">{{ review.product.name }}</h6></a>

                                    <div class="stars mb-2">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= review.rating %}
                                                ★
                                            {% else %}
                                                ☆
                                            {% endif %}
                                        {% endfor %}
                                    </div>

                                    <p class="card-text">{{ review.text }}</p>
                                    <hr>
                                    <small class="text-muted">Статус: {{ review.get_status_display }}</small><br>
                                    <small class="text-muted">Дата: {{ review.created_at }}</small>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="card empty-card shadow-sm rounded-3 p-3 text-center text-muted">
                    Вы пока не оставляли отзывы о товарах.
                </div>
            {% endif %}
        </div>

        <!-- Отзывы о заказах -->
        <div class="tab-pane fade" id="order-reviews" role="tabpanel">
            {% if order_reviews %}
                <div class="row g-3">
                    {% for review in order_reviews %}
                        <div class="col-md-8 col-lg-6">
                            <div class="card review-card rounded-3">
                                <div class="card-body">
                                    <a href="{% url 'users:profile' %}" style="text-decoration: None; cursor: pointer"><h6 class="card-title mb-2">Заказ №{{ review.order.id }}</h6></a>

                                    <div class="stars mb-2">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= review.rating %}
                                                ★
                                            {% else %}
                                                ☆
                                            {% endif %}
                                        {% endfor %}
                                    </div>

                                    <p class="card-text">{{ review.text }}</p>
                                    <hr>
                                    <small class="text-muted">Статус: {{ review.get_status_display }}</small><br>
                                    <small class="text-muted">Дата: {{ review.created_at }}</small>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="card empty-card shadow-sm rounded-3 p-3 text-center text-muted">
                    Вы пока не оставляли отзывы о заказах.
                </div>
            {% endif %}
        </div>

        <!-- Обращения -->
        <div class="tab-pane fade" id="contacts" role="tabpanel">
            {% if contacts %}
                <div class="row g-3 justify-content-center">
                    {% for contact in contacts %}
                        <div class="col-md-8 col-lg-6">
                            <div class="card review-card rounded-3">
                                <div class="card-body">
                                    <h6 class="card-title mb-1">Тема: {{ contact.get_topic_display }} {% if contact.custom_topic %} — {{ contact.custom_topic }} {% endif %}</h6>
                                    <p class="card-text">{{ contact.message }}</p>
                                    <hr>
                                    <small class="text-muted">Статус: {{ contact.get_status_display }}</small><br>
                                    <small class="text-muted">Дата: {{ contact.created_at }}</small>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="row g-3 justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <div class="card empty-card shadow-sm rounded-3 p-3 text-center text-muted">
                            Вы пока не отправляли обращений.
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}
