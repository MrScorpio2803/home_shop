{% extends 'base.html' %}
{% load static %}

{% block title %}
Регистрация
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/my_footer_css.css' %}">
{% endblock %}

{% block body %}
<div class="container">
    <div class="col-lg-10">
        <div class="row">
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-md-9 bg-white p-4 mb-5 mx-2 rounded custom-shadow">
                        <h2 class="text-center mb-4">Регистрация</h2>
                        <form action="{% url 'users:register' %}" method="post">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="id_first_name" class="form-label">Имя*</label>
                                    <input type="text" class="form-control" id="id_first_name" name="first_name"
                                        placeholder="Введите ваше имя" value="{% if form.first_name.value %}{{ form.first_name.value }}{% endif %}" required>
                                    {% if form.first_name.errors %}
                                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                                {% for error in form.first_name.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_last_name" class="form-label">Фамилия*</label>
                                    <input type="text" class="form-control" id="id_last_name" name="last_name"
                                        placeholder="Введите вашу фамилию" value="{% if form.last_name.value %}{{ form.last_name.value }}{% endif %}" required>
                                    {% if form.last_name.errors %}
                                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                                {% for error in form.last_name.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_username" class="form-label">Имя пользователя*</label>
                                    <input type="text" class="form-control" id="id_username" name="username"
                                        placeholder="Введите ваше имя пользователя" value="{% if form.username.value %}{{ form.username.value }}{% endif %}" required>
                                    {% if form.username.errors %}
                                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                                {% for error in form.username.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_email" class="form-label">Email*</label>
                                    <input type="email" class="form-control" id="id_email" name="email"
                                        placeholder="Введите ваш email" value="{% if form.email.value %}{{ form.email.value }}
                                {% endif %}" required>
                                    {% if form.email.errors %}
                                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                                {% for error in form.email.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_password1" class="form-label">Пароль*</label>
                                    <input type="password" class="form-control" id="id_password1" name="password1"
                                        placeholder="Введите пароль" required>
                                    {% if form.password1.errors %}
                                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                                {% for error in form.password1.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="id_password2" class="form-label">Подтверждение пароля*</label>
                                    <input type="password" class="form-control" id="id_password2" name="password2"
                                        placeholder="Подтвердите пароль" required>
                                    {% if form.password2.errors %}
                                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                                {% for error in form.password2.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <button type="submit"
                                class="btn btn-dark btn-block">Зарегистрироваться</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    ['id_password1', 'id_password2'].forEach(function(fieldId) {
        const passwordInput = document.getElementById(fieldId);
        if (!passwordInput) return;

        const inputGroup = document.createElement('div');
        inputGroup.className = 'input-group mb-3';

        const passwordClone = passwordInput.cloneNode(true);

        const toggleBtnWrapper = document.createElement('span');
        toggleBtnWrapper.className = 'input-group-text';
        toggleBtnWrapper.style.cursor = 'pointer';

        // Иконка с перечёркнутым глазом по умолчанию
        const eyeIcon = document.createElement('i');
        eyeIcon.className = 'bi bi-eye-slash';

        toggleBtnWrapper.appendChild(eyeIcon);

        toggleBtnWrapper.addEventListener('click', function() {
            if (passwordClone.type === 'password') {
                passwordClone.type = 'text';
                eyeIcon.className = 'bi bi-eye';
            } else {
                passwordClone.type = 'password';
                eyeIcon.className = 'bi bi-eye-slash';
            }
        });

        passwordInput.parentNode.replaceChild(inputGroup, passwordInput);
        inputGroup.appendChild(passwordClone);
        inputGroup.appendChild(toggleBtnWrapper);
    });
});

</script>
{% endblock %}