{% extends 'base.html' %}
{% load static %}

{% block title %}
Авторизация
{% endblock %}

{% block body %}
<div class="container">
    <div class="row mt-1">
        <div class="row">
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-md-6 bg-white p-4 mb-4 mx-3 rounded custom-shadow">
                        <h2 class="text-center mb-4">Авторизация</h2>

                        <form action="{% url 'users:login' %}" method="post">
                            {% csrf_token %}
                            {% if request.GET.next %}
                                <input type="hidden" name="next" value="{{ request.GET.next }}">
                            {% endif %}
                            <div class="mb-3">
                                <label for="id_username" class="form-label">Имя пользователя</label>
                                <input type="text" class="form-control" name="username" id="id_username" value="{% if form.username.value %}{{ form.username.value }}
                                {% endif %}"
                                       placeholder="Введите ваше имя пользователя" required>
                            </div>
                            <div class="mb-3">
                                <label for="id_password" class="form-label">Пароль</label>
                                <input type="password" class="form-control" name="password"
                                       id="id_password" placeholder="Введите ваш пароль" required>
                            </div>
                            {% if form.non_field_errors %}
                                <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                                    <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                                    <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                        {% for error in form.non_field_errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}
                            <button type="submit" class="btn btn-dark btn-block">Войти</button>
                        </form>
                        <div class="mt-3">
                            <a href="#">Забыли пароль?</a> | <a href="{% url 'users:register' %}">Создать аккаунт</a>
                        </div>
                        <hr>
                        <div class="text-center">
                            <p>Или авторизуйтесь через:</p>
                            <a href="#" class="btn btn-dark">
                                <img class="mx-1" src="{% static 'icons/google.svg' %}" alt="Google Icon" width="16" height="16">
                                Google
                            </a>
                            <a href="#" class="btn btn-dark">
                                <img class="mx-1" src="{% static 'icons/facebook.svg' %}" alt="Facebook Icon" width="16" height="16">
                                Facebook
                            </a>
                            <a href="#" class="btn btn-dark">
                                <img class="mx-1" src="{% static 'icons/github.svg' %}" alt="GitHub Icon" width="16" height="16">
                                GitHub
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    const passwordInput = document.querySelector('input[type="password"]');
    if (!passwordInput) return;

    const inputGroup = document.createElement('div');
    inputGroup.className = 'input-group mb-3';

    const passwordClone = passwordInput.cloneNode(true);

    const toggleBtnWrapper = document.createElement('span');
    toggleBtnWrapper.className = 'input-group-text';
    toggleBtnWrapper.style.cursor = 'pointer';

    // Создаем иконку с закрытым глазом (по умолчанию)
    const eyeIcon = document.createElement('i');
    eyeIcon.className = 'bi bi-eye-slash'; // перечёркнутый глаз

    toggleBtnWrapper.appendChild(eyeIcon);

    toggleBtnWrapper.addEventListener('click', function() {
        if (passwordClone.type === 'password') {
            passwordClone.type = 'text';
            eyeIcon.className = 'bi bi-eye';  // открытый глаз
        } else {
            passwordClone.type = 'password';
            eyeIcon.className = 'bi bi-eye-slash';  // перечёркнутый глаз
        }
    });

    passwordInput.parentNode.replaceChild(inputGroup, passwordInput);
    inputGroup.appendChild(passwordClone);
    inputGroup.appendChild(toggleBtnWrapper);
});
</script>
{% endblock %}
