{% extends 'base.html' %}

{% load static %}
{% load cart_tags %}

{% block title %}
Оформление заказа
{% endblock %}

{% block body %}
{% user_carts request as carts %}
<div class="container">
    <h3 class="text-center mb-4">Выбранные товары</h3>
    <div class="container" id="cart-items-container">
        <!-- Разметка корзины -->
        {% include 'cart/includes/cart_main_part.html' %}
        <!-- Закончилась разметка корзины -->
    </div>
</div>
<!-- Детали заказа -->
<div class="container">
    <h3 class="text-center">Детали заказа</h3>
    <div class="card mb-3">
        <div class="card-body">
            <form action="{% url 'orders:create_order' %}" method="post">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="id_first_name" class="form-label">Имя*:</label>
                        <input type="text" class="form-control" id="id_first_name"
                            name="first_name" 
                            value="{% if form.first_name.value %}{{ form.first_name.value }}{% endif %}"
                            required>
                        {% if form.first_name.errors %}
                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                {% for error in form.first_name.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="id_last_name" class="form-label">Фамилия*:</label>
                        <input type="text" class="form-control" id="id_last_name" name="last_name" 
                        value="{% if form.last_name.value %}{{ form.last_name.value }}{% endif %}"
                        required>
                        {% if form.last_name.errors %}
                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                {% for error in form.last_name.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="id_phone_number" class="form-label">Номер телефона*:</label>
                        <input type="text" class="form-control" id="id_phone_number" name="phone_number"
                            placeholder="В формате: XXX-XXX-XX-XX"
                            value="{% if form.phone_number.value %}{{ form.phone_number.value }}{% endif %}"
                            required>
                        {% if form.phone_number.errors %}
                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                {% for error in form.phone_number.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="col-md-12 mb-3">
                        <label for="delivery" class="form-label">Способ доставки: </label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="delivery"
                                id="id_delivery" value="1" checked>
                            <label class="form-check-label" for="id_delivery">Нужна
                                доставка</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="delivery"
                                id="id_delivery" value="0">
                            <label class="form-check-label" for="id_delivery">Самовывоз</label>
                        </div>
                    </div>
                    <div class="mb-3" id="deliveryAddressField">
                        <label for="id_delivery_address" class="form-label">Адрес
                            доставки*:</label>
                        <textarea class="form-control" id="id_delivery_address"
                            name="delivery_address" 
                            value="{% if form.delivery_address.value %}{{ form.delivery_address.value }}{% endif %}"
                            rows="2"></textarea>
                        {% if form.delivery_address.errors %}
                        <div class="d-flex align-items-center border rounded p-2 mb-3" style="border-color: #ccc; background-color: #fafafa;">
                            <span class="me-2 text-warning" style="font-size: 1.2rem;">⚠️</span>
                            <div style="color: #444; font-weight: 500; font-size: 0.95rem; line-height: 1.4;">
                                {% for error in form.delivery_address.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                            
                    </div>
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Способ оплаты: </label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="is_payment_on_get"
                                id="id_is_payment_on_get" value="0" checked>
                            <label class="form-check-label" for="id_is_payment_on_get">Оплата
                                картой</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="is_payment_on_get"
                                id="id_is_payment_on_get" value="1">
                            <label class="form-check-label" for="id_is_payment_on_get">Наличными/картой
                                при плучении</label>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-dark">Оформить заказ</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/5.0.9/inputmask.min.js"></script>
<script>
    var phoneInput = document.getElementById("id_phone_number");
    Inputmask("999-999-99-99", { removeMaskOnSubmit: true }).mask(phoneInput);
</script>
{% endblock %}
